plugins: ['netbox_topology_views']

pluginsConfig: {
  'netbox_topology_views': {}
}

netbox:
  command:
    - /usr/bin/tini
    - --
    - /bin/sh
    - -c
    - |
      echo "Installing NetBox plugins..."
      pip install --no-cache-dir netbox-dns netbox-topology-views
      
      echo "Running migrations for plugins..."
      cd /opt/netbox/netbox
      python manage.py migrate
      python manage.py collectstatic --no-input
      
      echo "Starting NetBox with Unit..."
      exec /opt/netbox/docker-entrypoint.sh /opt/netbox/launch-netbox.sh

powerFeedDefaultVoltage: 230

preferIPv4: true

postgresql:
  enabled: true
  auth:
    username: netbox
    database: netbox
    existingSecret: postgresql

persistence:
  enabled: true
  storageClass: longhorn
  subPath: ""
  accessMode: ReadWriteMany
  size: 1Gi
  existingClaim: ""
  annotations: {}

resources:
  requests:
    cpu: 500m
    memory: 1Gi
  limits:
    cpu: 750m
    memory: 2Gi

worker:
  enabled: false

valkey:
  enabled: true
  architecture: standalone
  replica:
    replicaCount: 0

ingress:
  enabled: true
  pathType: ImplementationSpecific
  className: traefik
  annotations:
    traefik.ingress.kubernetes.io/router.middlewares: traefik-redirect@kubernetescrd
  hosts:
    - host: netbox.gavriliu.com
      paths:
        - /
